{% set layout = "ClarolineCoreBundle:Workspace:layout.html.twig" %}

           
{% extends layout %}

{% block leftSide %}
TEST
{% endblock %}

{% from _self import renderPager %}

{% block section_content %}
    <div class="panel-heading">
        <h3 class="panel-title">{{ 'list_results'|trans({}, 'search') }}</h3>
    </div>
    <div class="panel-body">
	    <div class="col-md-6">
<p>{{ 'nb_results'|trans({}, 'search') }} : {{ nbResults }}</p>
<br/>Time {{time}} ms
		</div>
		<div class="col-md-6">
			 <div class="input-group">
			   <input class="form-control" type="text" id="search-items-txt" placeholder="{{ 'search'|trans({}, 'search') }}" value="{{ name }}">
				<span class="input-group-btn">
					<button class="filter btn btn-default" type="button" id="search-button">
						<i class="icon-search"></i>
					</button>
				</span>
			</div>
		</div>

	    <div class="col-md-3">
		<h3>Content Type</h3>
		{% for facet,value in facets %}
		{{facet}} ({{value}})<br />
		{% endfor %}
        </div>

	    <div class="col-md-3">
		<h3>Facet Workspace</h3>
		{% for facet,value in facetsWks %}
		{{facet}} ({{value}})<br />
		{% endfor %}
        </div>

		<table id="subjects_table" class="table table-striped table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>{{ 'file'|trans({}, 'search') }}</th>
                        <th>{{ 'name'|trans({}, 'search') }}</th>
                        <th>{{ 'type'|trans({}, 'search') }}</th>
                        <th>{{ 'page / taille'|trans({}, 'search') }}</th>
                    </tr>
                </thead>
                <tbody id="table-subjects-body">
		{% for document in results %}
					<tr><td><a href='http://p-mooc-dev/claroline/20131113/Claroline/web/app_dev.php/resource/open/{{document["type"]}}/{{document["resource_id"]}}'><img src='http://p-mooc-dev/claroline/20131113/Claroline/web/{{document["res_icon_location"]}}' width='24px' /></a></td>
					<td>{{document["name"]}}<br /><small>Cours : {{document["wks_name"]}} / Owner : {{document["last_name"]}} {{document["first_name"]}}</small><br/>
					<i><font color='grey'>{{document["content"]|raw}}...</font></i></td>
					<td>{{document["content_type"]}}<br /><small>{{document["mime_type"]}}</small></td>
					<td>
					{% if document["mime_type"] == "image/png" %}
					{{document["attr_width"]}}*{{document["attr_height"]}} pixels 
					{% endif %}
					{% if (document["mime_type"] == "application/pdf") or (document["mime_type"] == "application/octet-stream") %}
					{{document["attr_xmpTPg:NPages"]}} pages 
					{% endif %}
					{{document["attr_stream_size"]}} octets
					</td>
					</tr>
					<!--
					<tr><td colspan='4'>
					{{document["content"]}}
					</td></tr>
					-->
				
<!--
			{% for field,value in document %}
				{% if value[0] is not defined %}
					<tr><th> {{ field }} </th><td> {{ value }} 
					{% if field == "res_icon_location" %}
						<img src='http://p-mooc-dev/claroline/20131113/Claroline/web/{{document["res_icon_location"]}}' width='24px' />
					{% endif %}
					{% if field == "name" %}
				 <a href='http://p-mooc-dev/claroline/20131113/Claroline/web/app_dev.php/resource/open/{{document["type"]}}/{{document["resource_id"]}}'>Voir la ressource</a>
					{% endif %}
					</td></tr>
				{% else %}
					<tr><th> {{ field }} </th><td> {{ value|join(',') }} </td></tr>
				{% endif %}
			{% endfor %}
-->
        {% endfor %}

			</tbody>
			</table>
		{# Arrondi à faire pour avoir le bon nombre de page #}
		{% set maxPage = nbResults / nbByPage %}
		Page
		{% for p in 1..maxPage %}
		{% if p == page %}
		 <b> {{ p }}</b>
		 {% else %}
		  <a href='{{ path('orange_search_request', {'name': name, 'page': p, 'nb': nbByPage}) }}'>{{p}}</a>
		 {% endif %}
		{% endfor %}
		  <a href='{{url}}/search/request/{{name}}/page/{{p}}/nb/{{nbByPage}}'>{{ p }}</a>
			</div>
    </div>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% javascripts
        vars=["locale"]
        "@ClarolineCoreBundle/Resources/views/Modal/modal.html.twigjs"
        "@ClarolineCoreBundle/Resources/views/Modal/validationFooter.html.twigjs"
        filter="twig_js"
    %}
    <script language="javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script>
        $('#search-button').on('click', function(event) {
            event.preventDefault();
            var search = document.getElementById('search-items-txt').value;
            if (search !== '') {
                var route = Routing.generate('claro_forum_search', 'name': document.getElementById('search-items-txt').value});
				console.log(route);
                window.location.href = route;
            }
        });
    </script>
{% endblock %}
